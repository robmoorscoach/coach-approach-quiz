<!-- CHUNK 1 of 4: DOCTYPE to end of </head> -->
<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Coach Approach | Leadership Profile</title>

  <style>
    :root{
      --bg:#06162b;
      --bg2:#041021;
      --panel: rgba(255,255,255,.04);
      --panel2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.18);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.74);
      --muted2: rgba(255,255,255,.60);
      --orange:#ff7a18;
      --orangeSoft: rgba(255,122,24,.16);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 18px;
      --r2: 26px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(255,122,24,.14), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(255,255,255,.06), transparent 55%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      min-height:100vh;
      padding: 28px 16px 70px;
      overflow-x:hidden;
    }

    a{ color: inherit; }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
    }

    .shell{
      border: 1px solid var(--stroke);
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .topbar{
      padding: 18px 18px 14px;
      display:flex;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
    }

    .brand{
      display:flex;
      gap: 12px;
      align-items: center;
      min-width:0;
    }

    .pillBrand{
      display:inline-flex;
      align-items:center;
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(255,122,24,.12);
      border: 1px solid rgba(255,122,24,.35);
      color: var(--orange);
      font-weight: 800;
      letter-spacing: .6px;
      font-size: 12px;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .titleBlock{
      display:flex;
      flex-direction: column;
      gap: 6px;
      min-width:0;
    }

    .h1{
      font-size: 22px;
      font-weight: 900;
      margin: 0;
      line-height: 1.15;
    }

    .meta{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }

    button, .linkBtn{
      appearance: none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 800;
      cursor: pointer;
      transition: .15s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select:none;
    }

    button:hover, .linkBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
    }

    button:active, .linkBtn:active{ transform: translateY(0); }

    .btnOrange{
      border-color: rgba(255,122,24,.55);
      background: rgba(255,122,24,.14);
    }

    .btnGhost{
      opacity: .95;
    }

    .content{
      padding: 18px;
    }

   .grid{
      display:grid;
      grid-template-columns: 1fr; /* single column */
      gap: 14px;
    }

    .panel{
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding: 16px;
    }

    .panel h2{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
    }

    .subhead{
      margin: 0 0 10px;
      color: var(--muted);
      line-height: 1.45;
      font-size: 14px;
    }

    .mini{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .note{
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }

    .tip{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,122,24,.35);
      background: rgba(255,122,24,.08);
      color: var(--muted);
    }

    .orange{
      color: var(--orange);
      font-weight: 900;
    }

    /* Quiz meta row */
    .quizMetaRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
      align-items:center;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 13px;
      font-weight: 800;
    }

    .field{ margin-top: 10px; }

    input[type="text"]{
      width: 100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--text);
      outline: none;
      font-weight: 800;
    }

    /* Questions */
    .qList{
      margin-top: 14px;
      display:flex;
      flex-direction: column;
      gap: 12px;
    }

    .q{
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 14px;
      background: rgba(0,0,0,.12);
    }

    .q .title{
      margin: 0 0 10px;
      font-weight: 900;
      line-height: 1.35;
    }

    .scale{
  display:grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 10px;
  align-items: stretch;
}

    .opt{
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 10px 0;
      text-align: center;
      font-weight: 900;
      background: rgba(255,255,255,.02);
      cursor: pointer;
      user-select: none;
      transition: .12s ease;

        /* Fix narrow buttons */
        min-width: 64px;
        min-height: 46px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    input[type="radio"]{ display:none; }

    input[type="radio"]:checked + .opt{
      border-color: rgba(255,122,24,.70);
      background: rgba(255,122,24,.16);
      transform: translateY(-1px);
    }

    .scaleNote{
      margin: 10px 0 0;
      color: var(--muted2);
      font-size: 13px;
      line-height: 1.35;
    }

    .warn{
      display:none;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,122,24,.35);
      background: rgba(255,122,24,.08);
      color: rgba(255,255,255,.86);
      font-weight: 800;
    }

    /* Snapshot (hidden until submit) */
    #snapshotPanel{ display:none; }

    .bars{ display:flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    .barRow{ display:grid; grid-template-columns: 110px 1fr 60px; gap: 10px; align-items:center; }
    .barTrack{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.06); overflow:hidden; border: 1px solid var(--stroke); }
    .barFill{ height:100%; width:0%; background: rgba(255,122,24,.88); }
    .label{ font-weight: 900; }
    .val{ text-align:right; color: var(--muted); font-weight: 900; }

    /* Report (hidden until submit) */
    #report{ display:none; margin-top: 14px; }
    .reportGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .reportGrid{ grid-template-columns: 1fr; }
    }

    .callout{
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.15);
      margin-top: 10px;
      color: var(--muted);
    }

    .coachBox{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 14px;
      background: rgba(0,0,0,.18);
    }

    .coachBox p{ margin: 8px 0; }

    .pillRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0;
    }

    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,122,24,.35);
      background: rgba(255,122,24,.08);
      color: var(--orange);
      font-weight: 900;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    /* Energy map */
    .radarWrap{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px;
      background: rgba(0,0,0,.12);
    }
    canvas{ width:100%; height: 240px; display:block; }

    /* Bottom actions */
    .footerActions{
      margin-top: 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .footerActions .spacer{ flex:1; }

    /* Premium feel: subtle progress + generate state */
    .progressLine{
      display:none;
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .progressBar{
      height:100%;
      width:0%;
      background: rgba(255,122,24,.70);
      transition: width .25s ease;
    }
    .genState{
      display:none;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-weight: 800;
    }

    /* Export modal */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: rgba(0,0,0,.55);
      z-index: 9999;
    }
    .modal{
      width: min(920px, 100%);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(9,28,52,.96), rgba(6,18,38,.96));
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      overflow: hidden;
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .modalHead h3{ margin:0; font-size: 16px; font-weight: 900; }
    .iconBtn{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 900;
      cursor: pointer;
    }
    .modalBody{ padding: 14px 16px 16px; }
    textarea{
      width:100%;
      min-height: 280px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.45;
    }
    .modalActions{
      display:flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 10px;
    }

    /* Print: make the report clean */
    @media print{
      body{ background:#fff; color:#000; padding:0; }
      .topbar, .actions, .footerActions, .overlay{ display:none !important; }
      .shell{ box-shadow:none; border:none; }
      .panel{ border:1px solid #ddd; background:#fff; }
      .pillBrand{ border:1px solid #ccc; color:#000; background:#f4f4f4; }
      .orange{ color:#000; }
      canvas{ height:220px; }
    }
    /* When snapshot is hidden, make the layout single-column */
.grid.single{
  grid-template-columns: 1fr !important;
}

    /* When snapshot is hidden, make the layout single-column */
.grid.single{
  grid-template-columns: 1fr !important;
}

/* --- Mobile safety rails (prevents horizontal clipping) --- */
html, body{
  width:100%;
  max-width:100%;
  overflow-x:hidden;
}

*, *::before, *::after{
  box-sizing:border-box;
}

img, svg, canvas, iframe{
  max-width:100%;
  height:auto;
}

.panel,
.wrap,
.shell,
.reportGrid{
  max-width:100%;
}

    /* --- Mobile fix: stop horizontal overflow + stack the top bar --- */
html, body { max-width: 100%; overflow-x: hidden; }
* { box-sizing: border-box; }

.shell, .wrap { width: 100%; max-width: 100%; }

@media (max-width: 700px){
  .topbar{
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
    gap: 12px;
  }

  .brand{
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }

  .titleBlock{
    width: 100%;
    min-width: 0;
  }

  .actions{
    width: 100%;
    justify-content: flex-start;
  }

  /* make sure anything “wide” can’t force overflow */
  canvas, svg, img { max-width: 100%; height: auto; }
}

    /* --- Mobile width fix (prevents right-side cut-off) --- */
html, body{
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}

*, *:before, *:after{
  box-sizing: border-box;
}

/* Ensure your outer containers never exceed the viewport */
.wrap, .shell{
  width: 100%;
  max-width: 100%;
}

/* If you have any containers using fixed widths, this neutralises them on mobile */
@media (max-width: 520px){
  .shell{
    margin: 0;
    border-radius: 0;
  }

  /* The most common culprit: answer buttons having min-width */
  button{
    max-width: 100%;
  }

  /* If your options row uses flex, allow it to shrink/wrap */
  .scaleRow, .optionsRow, .answersRow, .likertRow{
    flex-wrap: wrap;
  }

  /* If your options row uses grid, force it to fit the screen */
  .scaleRow, .optionsRow, .answersRow, .likertRow{
    display: grid;
    grid-template-columns: repeat(5, minmax(0, 1fr));
    gap: 10px;
  }

  /* And remove any minimum button width so columns can actually shrink */
  .scaleRow button, .optionsRow button, .answersRow button, .likertRow button{
    min-width: 0 !important;
    width: 100%;
  }
}

    @media (max-width: 520px){
  .opt{
    min-width: 0 !important;
  }
}
    
  </style>
</head>

<!-- CHUNK 2 of 4: <body> structure -->
<body>
  <div class="wrap">
    <div class="shell">

      <!-- Top bar -->
      <div class="topbar">
        <div class="brand">
          <div class="pillBrand">The Coach Approach</div>
          <div class="titleBlock">
            <h1 class="h1">Leadership Profile</h1>
            <p class="meta">A reflective leadership survey. Your report is generated locally in your browser.</p>
            <p class="mini">Takes about 4 minutes · Progress saved locally · Nothing is uploaded</p>
          </div>
        </div>
        <div class="actions">
          <button class="btnOrange" id="submitTop" disabled>Submit answers</button>
        </div>
      </div>

      <!-- Main content -->
      <div class="content">
        <div class="grid">

          <!-- LEFT: Survey -->
          <div class="panel">
            <h2>How to answer</h2>
            <p class="subhead">
              Choose the response that best reflects what you <strong>do most often</strong>, not what you aspire to.
              If you’re unsure, answer based on your default behaviour <strong>under pressure</strong>.
            </p>

            <div class="quizMetaRow">
              <span class="chip">40 questions</span>
              <span class="chip">5-point scale</span>
              <span class="chip">No right or wrong answers</span>
            </div>

            <p class="mini" id="progressText" style="margin-top:10px;">0 / 40 answered</p>

            <!-- Questions -->
            <div class="qList" id="questions"></div>

            <!-- Warning -->
            <div class="warn" id="warn">
              Please answer all questions before generating your report.
            </div>

            <!-- Bottom submit -->
            <div class="footerActions">
              <button class="btnOrange" id="submitBottom" disabled>Submit answers</button>
              <div class="spacer"></div>
              <button class="btnGhost" id="resetBtn" type="button">Reset answers</button>
            </div>

            <!-- Generate state -->
            <div class="progressLine" id="progressLine">
              <div class="progressBar" id="progressBar"></div>
            </div>
            <div class="genState" id="genState">Generating your report…</div>
          </div>

          <!-- RIGHT: Snapshot -->
          <div class="panel" id="snapshotPanel">
            <h2>Snapshot</h2>
            <p class="subhead">
              A simple view of how your leadership energy is currently distributed.
            </p>

            <div class="bars">
              <div class="barRow">
                <div class="label">Command</div>
                <div class="barTrack"><div class="barFill" id="bar-command"></div></div>
                <div class="val" id="val-command">0%</div>
              </div>
              <div class="barRow">
                <div class="label">Control</div>
                <div class="barTrack"><div class="barFill" id="bar-control"></div></div>
                <div class="val" id="val-control">0%</div>
              </div>
              <div class="barRow">
                <div class="label">Clarity</div>
                <div class="barTrack"><div class="barFill" id="bar-clarity"></div></div>
                <div class="val" id="val-clarity">0%</div>
              </div>
              <div class="barRow">
                <div class="label">Connection</div>
                <div class="barTrack"><div class="barFill" id="bar-connection"></div></div>
                <div class="val" id="val-connection">0%</div>
              </div>
            </div>

            <div class="tip">
              <strong>Note:</strong> High scores show preference, not competence.
              The value comes from noticing what you lean on most — and what you may under-use.
            </div>
          </div>

        </div>

<!-- REPORT (hidden until submit) -->
<div id="report">

  <div class="panel" id="reportSummary" style="margin-bottom:14px;">
    <h2 style="margin-bottom:6px;">Your summary</h2>
    <p class="subhead" id="summaryLine" style="margin-bottom:12px;"></p>

    <div class="quizMetaRow" style="margin-top:0;">
      <span class="chip" id="sumDominant"></span>
      <span class="chip" id="sumSecondary"></span>
      <span class="chip" id="sumUnder"></span>
      <span class="chip" id="sumApproach"></span>
      <span class="chip" id="sumReady"></span>
      <span class="chip" id="sumBalance"></span>
    </div>

    <div class="callout" id="bringToSession" style="margin-top:12px;"></div>
  </div>

  <div class="reportGrid">

    <!-- Energy map -->
    <div class="panel">
      <h2>Energy Map</h2>
      <p class="subhead">
        This map shows how your leadership energy is distributed across four core modes.
      </p>
      <div class="radarWrap">
        <canvas id="radar"></canvas>
      </div>
    </div>

    <!-- Best of you -->
    <div class="panel">
      <h2>At your best</h2>
      <p class="subhead" id="bestText"></p>
      <div class="callout" id="bestCallout"></div>
    </div>

    <!-- Under pressure -->
    <div class="panel">
      <h2>Under pressure</h2>
      <p class="subhead" id="pressureText"></p>
      <div class="callout" id="resetRoutine"></div>
    </div>

    <!-- Coach guidance -->
    <div class="panel">
      <h2>Your Coach Approach guidance</h2>
      <div class="coachBox">
        <p><strong>Focus on:</strong> <span id="coachFocus"></span></p>
        <p><strong>Watch out for:</strong> <span id="coachWatch"></span></p>
        <p><strong>Build this by:</strong> <span id="coachBuild"></span></p>
      </div>
    </div>

    <!-- Leadership approach -->
    <div class="panel" id="leadershipApproachBlock" style="grid-column: 1 / -1;">
      <h2>Your Leadership Approach</h2>

      <div class="pillRow">
        <span class="pill" id="approachPill"></span>
        <span class="pill" id="focusPill"></span>
      </div>

      <p class="subhead" id="leadershipApproachLine"></p>

      <div class="coachBox">
        <p><strong>Primary focus:</strong> <span id="approachFocus"></span></p>
        <p><strong>Watch out for:</strong> <span id="approachWatchout"></span></p>
        <p><strong>Coach tip:</strong> <span id="approachTip"></span></p>
      </div>

      <p class="mini" id="approachBalanceNote"></p>
    </div>

    <!-- 30 day experiment -->
    <div class="panel" style="grid-column: 1 / -1;">
      <h2>30-day experiment</h2>
      <p class="subhead">
        Choose one behaviour to practise deliberately for the next 30 days.
        Keep it small, observable, and realistic.
      </p>
      <div class="callout">
        <p id="experimentIntro"></p>
        <ul id="experimentSteps" style="margin:10px 0 0; padding-left:18px; line-height:1.6;"></ul>
        <p class="mini" id="experimentReflection" style="margin-top:10px;"></p>
      </div>
    </div>

  </div> <!-- end .reportGrid -->

  <!-- Export actions -->
  <div class="footerActions">
    <button class="btnGhost" id="printBtn">Print / Save as PDF</button>
    <button class="btnGhost" id="exportBtn">Export results data</button>

    <a class="linkBtn"
       href="https://robmoors.com/contact-me"
       target="_blank" rel="noopener">
      Contact Rob
    </a>

    <div class="spacer"></div>

    <p class="mini" style="margin-top:6px; flex-basis:100%;">
      Tip: Printing works best when this report is opened in a new tab.
    </p>

    <a class="btnGhost"
       href="https://robmoorscoach.github.io/coach-approach-quiz/"
       target="_blank" rel="noopener">
      Open full page
    </a>
  </div>

</div> <!-- end #report -->
        </div>
    </div>
  </div>

  <!-- Export modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalHead">
        <h3>Export results data</h3>
        <button class="iconBtn" id="closeModal">×</button>
      </div>
      <div class="modalBody">
        <textarea id="exportArea" readonly></textarea>
        <div class="modalActions">
          <button class="btnGhost" id="copyExport">Copy</button>
          <button class="btnOrange" id="closeExport">Close</button>
        </div>
      </div>
    </div>
  </div>
<script>

    // ============================================================
    // SECTION B (Chunk 3): Data + libraries + helper functions
    // Paste directly after: <script>
    // ============================================================

    // Energy order for the radar + report:
    // We keep opposites apart (Command not next to Connection, Control not next to Clarity)
    const ENERGIES = ["command", "control", "connection", "clarity"];

    const ENERGY_LABEL = {
      command: "Command",
      control: "Control",
      clarity: "Clarity",
      connection: "Connection"
    };

    // ============================================================
    // Questions (40 total, 10 per energy)
    // ============================================================
    const QUESTIONS = [
      // Command (10)
      { id: 1,  e:"command",   t:"I’m comfortable making the call when a decision is needed." },
      { id: 2,  e:"command",   t:"I step in quickly when progress stalls." },
      { id: 3,  e:"command",   t:"I’m comfortable challenging poor performance directly." },
      { id: 4,  e:"command",   t:"When pace matters, I step in and take charge." },
      { id: 5,  e:"command",   t:"I say what needs saying, even if it’s uncomfortable." },
      { id: 6,  e:"command",   t:"I can hold firm when others disagree." },
      { id: 7,  e:"command",   t:"I make decisions quickly when others hesitate." },
      { id: 8,  e:"command",   t:"I’m clear and direct about what needs to happen next." },
      { id: 9,  e:"command",   t:"I can have difficult conversations without avoiding them." },
      { id: 10, e:"command",   t:"I take responsibility for making the tough calls." },

      // Control (10)
      { id: 11, e:"control",   t:"I set clear expectations and hold people to them." },
      { id: 12, e:"control",   t:"I focus on outcomes and deadlines as the priority." },
      { id: 13, e:"control",   t:"I like having a clear plan and process." },
      { id: 14, e:"control",   t:"I follow through and make sure actions happen." },
      { id: 15, e:"control",   t:"I bring structure when things feel messy." },
      { id: 16, e:"control",   t:"I prefer clarity on roles, responsibilities and ownership." },
      { id: 17, e:"control",   t:"I track progress and keep work on course." },
      { id: 18, e:"control",   t:"I make work feel manageable by defining the steps." },
      { id: 19, e:"control",   t:"I’m consistent, reliable and organised." },
      { id: 20, e:"control",   t:"I reduce risk by getting the basics right." },

      // Clarity (10)
      { id: 21, e:"clarity",   t:"I help people see the bigger picture and the ‘why’." },
      { id: 22, e:"clarity",   t:"I simplify complexity into clear priorities." },
      { id: 23, e:"clarity",   t:"I’m good at turning ideas into direction." },
      { id: 24, e:"clarity",   t:"I communicate purpose in a way that motivates people." },
      { id: 25, e:"clarity",   t:"I help teams align around what matters most." },
      { id: 26, e:"clarity",   t:"I keep conversations focused on what success looks like." },
      { id: 27, e:"clarity",   t:"I can explain things clearly so people ‘get it’." },
      { id: 28, e:"clarity",   t:"I’m comfortable naming what’s important and what’s not." },
      { id: 29, e:"clarity",   t:"I cut through noise and make the next step obvious." },
      { id: 30, e:"clarity",   t:"I bring direction when people feel unclear." },

      // Connection (10)
      { id: 31, e:"connection",t:"I notice how people are feeling and take it seriously." },
      { id: 32, e:"connection",t:"I create space for people to speak honestly." },
      { id: 33, e:"connection",t:"I build trust by listening properly." },
      { id: 34, e:"connection",t:"I’m patient with people who need time to think." },
      { id: 35, e:"connection",t:"I help people feel safe enough to be real." },
      { id: 36, e:"connection",t:"I adapt my approach depending on who I’m with." },
      { id: 37, e:"connection",t:"I’m curious about what’s going on underneath the surface." },
      { id: 38, e:"connection",t:"I build commitment by involving people in the ‘how’." },
      { id: 39, e:"connection",t:"I look for what people need, not just what they deliver." },
      { id: 40, e:"connection",t:"I create belonging and connection in teams." }
    ];

    // Answers store: id -> 1..5
    const answers = {};

    // ============================================================
    // Content library (dominant energy report blocks)
    // ============================================================
    const CONTENT = {
      command: {
        bestTitle: "Command at your best",
        best: [
          "You bring decisiveness when others hesitate.",
          "You protect standards and address issues quickly.",
          "You create momentum when the pace slows.",
          "You help people face reality without drama."
        ],
        watchTitle: "Command watchouts",
        watch: [
          "You may push too hard and lose people’s buy-in.",
          "You can become blunt when you’re under pressure.",
          "You may move so fast others can’t keep up.",
          "You might assume clarity exists because you feel certain."
        ],
        pressure:
          "Under pressure, you may default to action, urgency and directness. That can be helpful, but it can also feel like intensity to others. Your growth edge is to add Connection and Clarity before you push for the next step.",
        reset:
          "Reset routine (60 seconds): Pause. Name the outcome. Ask one real question. Then choose the smallest next action.",
        coachMove:
          "Your Coach Approach move: stay curious for 60 seconds longer before you move to instruction.",
        mindset:
          "Shift from “I need to keep control” to “I need to create clarity and trust so others can take ownership.”",
        toolset:
          "Use one question before you direct: “What do you see?” then “What options do you have?” then “What will you do?”",
        skillset:
          "Practise reflective listening: summarise what you heard before you respond."
      },

      control: {
        bestTitle: "Control at your best",
        best: [
          "You create stability, reliability and follow-through.",
          "You reduce risk and prevent avoidable rework.",
          "You make work feel manageable through structure.",
          "You help teams stay organised and focused."
        ],
        watchTitle: "Control watchouts",
        watch: [
          "You may over-structure and reduce autonomy.",
          "You might default to process when the issue is people.",
          "You can become cautious or slow to act.",
          "You may struggle with ambiguity or experimentation."
        ],
        pressure:
          "Under pressure, you may tighten structure, process and detail. That can stabilise delivery, but it can also slow decisions and reduce ownership. Your growth edge is to add Clarity and Connection, not just more control.",
        reset:
          "Reset routine (60 seconds): Pause. Name what matters. Ask one real question. Then decide your next move.",
        coachMove:
          "Your Coach Approach move: keep the structure, but invite ownership inside it.",
        mindset:
          "Shift from “If it’s not controlled, it will fail” to “If it’s clear and trusted, it can flex.”",
        toolset:
          "Use a light check-in rhythm: progress, blockers, support, next step. Keep it short and human.",
        skillset:
          "Practise small experiments instead of perfect plans."
      },

      clarity: {
        bestTitle: "Clarity at your best",
        best: [
          "You make purpose and priorities simple.",
          "You cut through noise and name what matters.",
          "You create alignment by communicating the ‘why’.",
          "You help teams turn goals into action."
        ],
        watchTitle: "Clarity watchouts",
        watch: [
          "You may over-focus on direction and under-focus on emotion.",
          "You can assume understanding when people are overwhelmed.",
          "You might sell the vision but miss the support needed.",
          "You may rush to conclusions without listening fully."
        ],
        pressure:
          "Under pressure, you may over-explain, over-simplify, or push direction too quickly. That can create movement, but it can also miss what people are feeling. Your growth edge is to add Connection and Control so clarity lands and sticks.",
        reset:
          "Reset routine (60 seconds): Pause. Name what matters most. Ask what’s unclear. Confirm one priority and one next step.",
        coachMove:
          "Your Coach Approach move: keep the clarity, and slow down enough for people to own it.",
        mindset:
          "Shift from “If I explain it well, they’ll follow” to “If I involve them, they’ll own it.”",
        toolset:
          "Ask: “What’s most important here?” then “What would success look like in 2 weeks?”",
        skillset:
          "Practise concise leadership: one message, one priority, one next step."
      },

      connection: {
        bestTitle: "Connection at your best",
        best: [
          "You build trust and psychological safety.",
          "You create space for honesty and real conversation.",
          "You sense what’s unsaid and bring it into the room.",
          "You increase commitment by involving people."
        ],
        watchTitle: "Connection watchouts",
        watch: [
          "You may avoid tension to keep harmony.",
          "You can over-accommodate and lose direction.",
          "You may carry others’ emotions as your responsibility.",
          "You might delay decisions to protect relationships."
        ],
        pressure:
          "Under pressure, you may over-protect relationships, soften messages, or avoid challenge. That can keep things calm, but it can also blur standards. Your growth edge is to add Command and Clarity, with kindness.",
        reset:
          "Reset routine (60 seconds): Pause. Name what matters. Say one clear truth. Ask one coaching question.",
        coachMove:
          "Your Coach Approach move: keep the care, add a little more clarity and challenge.",
        mindset:
          "Shift from “Challenge might damage trust” to “Clear feedback is a form of respect.”",
        toolset:
          "Use: “What’s the real issue?” “What’s your responsibility here?” “What will you commit to?”",
        skillset:
          "Practise clean challenge: kind tone, clear message, direct request."
      }
    };

    // ============================================================
    // Leadership Approach mapping (adjacent pairs only)
    // ============================================================
    const approachMap = {
      "command|control": {
        label: "Manage",
        focus: "Results",
        desc: "Strong execution, standards and delivery. You create traction, tighten priorities, and keep work moving.",
        watch: "If everything becomes a task to manage, your time gets swallowed and ownership quietly drops. People comply, but don’t always commit.",
        build: "Keep your results focus, and deliberately practise Connection and Clarity so people understand the why and feel involved."
      },
      "command|clarity": {
        label: "Inspire",
        focus: "Purpose",
        desc: "Direction, meaning and momentum. You bring ambition, make priorities simple, and help others move with intent.",
        watch: "If you live in inspiration too long, people feel energised but impatient for the plan, the detail and the operating rhythm.",
        build: "Keep the purpose, and practise Control so the message becomes a plan. Add Connection so it lands as owned, not just heard."
      },
      "clarity|connection": {
        label: "Lead",
        focus: "People",
        desc: "Trust-building leadership. You create clarity with people, not at them, and align teams through conversation.",
        watch: "If you dwell here without enough edge, standards soften, pace drifts, and hard conversations get delayed.",
        build: "Keep the people focus, and practise Command and Control in small doses so standards and follow-through don’t drift."
      },
      "connection|control": {
        label: "Guide",
        focus: "Performance",
        desc: "Supportive performance guidance. You create structure that helps people succeed, and you coach without rescuing.",
        watch: "If you stay here too long, teams can perform well but lose connection to bold direction and the bigger picture.",
        build: "Keep the steady support, and practise Clarity and Command so purpose, goals and decisions stay visible."
      }
    };

    // ============================================================
    // Helper functions
    // ============================================================
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function titleCase(s){
      return String(s).charAt(0).toUpperCase() + String(s).slice(1);
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;",
        "<":"&lt;",
        ">":"&gt;",
        '"':"&quot;",
        "'":"&#39;"
      }[m]));
    }

    function $(id){ return document.getElementById(id); }

    function allAnswered(){
      for(const q of QUESTIONS){
        if(!answers[q.id]) return false;
      }
      return true;
    }

    function answeredCount(){
      let c = 0;
      for(const q of QUESTIONS) if(answers[q.id]) c++;
      return c;
    }

    function updateProgressUI(){
      const done = answeredCount();
      const total = QUESTIONS.length;
      const pct = Math.round((done / total) * 100);

      const line = $("progressLine");
      const label = $("progressLabel");

      if(line) line.style.width = pct + "%";
      if(label) label.textContent = `${done} / ${total} answered`;

      const canGenerateTop = $("generateTop");
      const canGenerateBottom = $("generateBottom");
      const ok = done === total;

      if(canGenerateTop) canGenerateTop.disabled = !ok;
      if(canGenerateBottom) canGenerateBottom.disabled = !ok;

      // Only show the "What you’ll get" block until report generated (Chunk 4 toggles)
    }

    function renderQuestions(){
      const host = $("questions");
      if(!host) return;

      const scale = [
        { v:1, label:"Strongly disagree" },
        { v:2, label:"Disagree" },
        { v:3, label:"Neutral" },
        { v:4, label:"Agree" },
        { v:5, label:"Strongly agree" }
      ];

      host.innerHTML = QUESTIONS.map((q) => {
        const current = answers[q.id] || 0;

        const opts = scale.map(s => {
          const checked = current === s.v ? "checked" : "";
          return `
            <label class="choice">
              <input type="radio" name="q${q.id}" value="${s.v}" ${checked} />
              <span class="dot">${s.v}</span>
            </label>
          `;
        }).join("");

        return `
          <div class="qCard" data-qid="${q.id}">
            <div class="qTop">
              <div class="qNo">${q.id}.</div>
              <div class="qText">${escapeHtml(q.t)}</div>
            </div>

            <div class="scaleRow" aria-label="Choose one option">
              ${opts}
            </div>

            <div class="scaleHint mini">1 = Strongly disagree · 5 = Strongly agree</div>
          </div>
        `;
      }).join("");

      // Delegate changes
      host.addEventListener("change", (e) => {
        const el = e.target;
        if(!el || el.tagName !== "INPUT") return;
        const name = el.name || "";
        const id = parseInt(name.replace("q",""), 10);
        const v = parseInt(el.value, 10);
        if(!Number.isFinite(id) || !Number.isFinite(v)) return;

        answers[id] = v;

        // Add visual selected state to the "dot"
        const card = host.querySelector(`[data-qid="${id}"]`);
        if(card){
          card.querySelectorAll(".choice .dot").forEach(d => d.classList.remove("isOn"));
          const chosen = el.closest(".choice")?.querySelector(".dot");
          if(chosen) chosen.classList.add("isOn");
        }

        updateProgressUI();
      }, { passive:true });

      // Set selected states on initial render
      QUESTIONS.forEach(q => {
        const v = answers[q.id];
        if(!v) return;
        const card = host.querySelector(`[data-qid="${q.id}"]`);
        if(!card) return;
        const radio = card.querySelector(`input[type="radio"][value="${v}"]`);
        const dot = radio?.closest(".choice")?.querySelector(".dot");
        if(dot) dot.classList.add("isOn");
      });
    }

    // ============================================================
    // Scoring
    // ============================================================
    function scoreEnergies(){
      const totals = { command:0, control:0, clarity:0, connection:0 };
      const maxPerEnergy = 10 * 5; // 10 questions * 5 max

      QUESTIONS.forEach(q => {
        const v = answers[q.id] || 0;
        totals[q.e] += v;
      });

      const pct = {};
      Object.keys(totals).forEach(k => {
        pct[k] = Math.round((totals[k] / maxPerEnergy) * 100);
      });

      return { totals, pct };
    }

    // Balance score: higher means more even energies
    // We convert "spread" into 0..100 where 100 is perfectly balanced.
    function computeBalanceScore(pcts){
      const arr = [pcts.command, pcts.control, pcts.clarity, pcts.connection].slice().sort((a,b)=>a-b);
      const min = arr[0], max = arr[3];
      const spread = max - min;                 // 0..100
      const balance = 100 - spread;             // 100..0
      return clamp(balance, 0, 100);
    }

    function isCoachApproachReady(pct){
      return (
      pct.command >= 60 &&
      pct.control >= 60 &&
      pct.clarity >= 60 &&
      pct.connection >= 60
    );
  }

    // Determine top, second, underused
    function rankEnergies(pcts){
      const entries = Object.keys(pcts).map(k => ({ k, v: pcts[k] }));
      entries.sort((a,b) => b.v - a.v);

      const top = entries[0];
      const second = entries[1];
      const under = entries[entries.length - 1];

      return { entries, top, second, under };
    }

    // Leadership Approach logic:
    // - If top two form a valid map pair => that approach
    // - Else if balance >= 70 => Flexible Balance
    // - Else => Tension Pair
  
  function getLeadershipApproach(topKey, secondKey, balanceScore){

  // 1) Extremely even: don’t force a pair
  if (balanceScore >= 90) {
    return {
      type: "adaptive",
      label: "Adaptive",
      focus: "Deliberate choice",
      desc: "Your energies are highly balanced. Rather than a fixed style, your strength is flexing to what the moment needs. Your edge is choosing your energy on purpose, not by habit.",
      watch: "Defaulting to comfort, speed, or what you do best, instead of choosing what the person and situation need.",
      build: "Before you respond, pause for 2 seconds and name the energy you’re choosing (Command, Control, Clarity, or Connection). Then act from that on purpose."
    };
  }

  // 2) Broadly even: flexible balance
  if (balanceScore >= 70) {
    return {
      type:"flex",
      label:"Flexible Balance",
      focus:"Flexibility",
      desc:"Your energies are relatively even. That usually means you can flex, depending on the situation.",
      watch:"The risk is reacting automatically. Your edge is choosing the right energy on purpose.",
      build:"Pick one situation this week and deliberately choose your ‘anchor’ energy first, before you respond."
    };
  }

  // 3) Otherwise, use the top-two pairing if it exists
  const a = [topKey, secondKey].sort().join("|");
  const hit = approachMap[a];
  if(hit){
    return { type:"named", ...hit };
  }

  // 4) Otherwise it’s a tension pattern
  return {
    type:"tension",
    label:"Tension Pair",
    focus:"Switching",
    desc:"Your top energies pull in different directions. That can create a ‘switching’ pattern depending on the situation.",
    watch:"People may experience you as inconsistent, or you may feel pulled between two instincts.",
    build:"Slow down and name the shift. Choose one clear anchor (standards or purpose, structure or people) before you act."
  };
}

    // Build a plain-text summary for copying/export
    function buildSummary(payload){
      const lines = [];
      lines.push("The Coach Approach | Leadership Profile");
      lines.push(`Date: ${payload.dateStr} · Balance score: ${payload.balance}/100`);
      lines.push("");
      lines.push(`Dominant energy: ${payload.dominantLabel} (${payload.pct[payload.dominant]}%)`);
      lines.push(`Secondary energy: ${payload.secondaryLabel} (${payload.pct[payload.secondary]}%)`);
      lines.push(`Underused energy: ${payload.underLabel} (${payload.pct[payload.under]}%)`);
      lines.push(`Leadership Approach: ${payload.approach.label}`);
      lines.push("");
      lines.push("Energies:");
      lines.push(`- Command: ${payload.pct.command}%`);
      lines.push(`- Control: ${payload.pct.control}%`);
      lines.push(`- Clarity: ${payload.pct.clarity}%`);
      lines.push(`- Connection: ${payload.pct.connection}%`);
      lines.push("");
      lines.push("Leadership Approach notes:");
      lines.push(`- Focus: ${payload.approach.focus}`);
      lines.push(`- Watchout: ${payload.approach.watch}`);
      lines.push(`- Coach tip: ${payload.approach.build}`);
      return lines.join("\n");
    }

    // ============================================================
    // End of Chunk 3
</script>

<script>
  // ============================================================
  // IMPORTANT: Chunk 3 created some helper functions and data.
  // In this final chunk we:
  // - Render the questions using the CSS already in Chunk 1
  // - Wire Submit (top + bottom)
  // - Generate Snapshot + Report (and show them)
  // - Draw the radar in the correct order
  // - Make Export Results Data work (modal + download)
  // - Close script/body/html tags
  // ============================================================

    // ============================================================
  // IMPORTANT: Chunk 3 created some helper functions and data.
  // ============================================================

  // ---------- Save/Resume (local only) ----------
  const STORAGE_KEY = "tca_leadership_profile_v1";

  function saveAnswers(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(answers));
    }catch(e){}
  }

  function loadAnswers(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const parsed = JSON.parse(raw);
      if(parsed && typeof parsed === "object"){
        for(const k in parsed){
          const id = parseInt(k, 10);
          const v = parseInt(parsed[k], 10);
          if(Number.isFinite(id) && Number.isFinite(v) && v >= 1 && v <= 5){
            answers[id] = v;
          }
        }
      }
    }catch(e){}
  }

  function clearAnswers(){
    try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
    for(const q of QUESTIONS) delete answers[q.id];
  }
  
  // --------- Replace/override renderQuestions to match Chunk 1 CSS ----------
  function renderQuestions(){
    const host = $("questions");
    if(!host) return;

    const scale = [
      { v:1, label:"Strongly disagree" },
      { v:2, label:"Disagree" },
      { v:3, label:"Neutral" },
      { v:4, label:"Agree" },
      { v:5, label:"Strongly agree" }
    ];

    host.innerHTML = QUESTIONS.map((q) => {
      const current = answers[q.id] || 0;
      const name = `q${q.id}`;

      const opts = scale.map(s => {
        const checked = current === s.v ? "checked" : "";
        // Note: input must be immediately followed by .opt for CSS to work
        return `
          <label>
            <input type="radio" name="${name}" value="${s.v}" ${checked} />
            <span class="opt" title="${escapeHtml(s.label)}">${s.v}</span>
          </label>
        `;
      }).join("");

      return `
        <div class="q" data-qid="${q.id}">
          <p class="title">${q.id}. ${escapeHtml(q.t)}</p>
          <div class="scale">${opts}</div>
          <p class="scaleNote">1 = Strongly disagree · 5 = Strongly agree</p>
        </div>
      `;
    }).join("");

    // Delegated change handler
    host.addEventListener("change", (e) => {
      const el = e.target;
      if(!el || el.tagName !== "INPUT") return;
      const qid = parseInt((el.name || "").replace("q",""), 10);
      const v = parseInt(el.value, 10);
      if(!Number.isFinite(qid) || !Number.isFinite(v)) return;
      answers[qid] = v;
      saveAnswers();
      updateCompletionUI();
      // Hide warning as soon as they resume answering
      $("warn").style.display = "none";
    }, { passive:true });
  }

  // --------- Premium feel: generation state ----------
  function setGenerating(isOn){
    const line = $("progressLine");
    const bar = $("progressBar");
    const msg = $("genState");

    if(isOn){
      if(line) line.style.display = "block";
      if(msg) msg.style.display = "block";
      if(bar) {
        bar.style.width = "15%";
        setTimeout(()=>bar.style.width="55%", 120);
        setTimeout(()=>bar.style.width="85%", 240);
      }
    } else {
      if(bar) bar.style.width = "100%";
      setTimeout(()=>{
        if(line) line.style.display = "none";
        if(msg) msg.style.display = "none";
        if(bar) bar.style.width = "0%";
      }, 250);
    }
  }

  // --------- Snapshot bars ----------
  function setBar(idFill, idVal, pct){
    const fill = $(idFill);
    const val  = $(idVal);
    if(fill) fill.style.width = `${pct}%`;
    if(val) val.textContent = `${pct}%`;
  }

  // --------- Radar drawing ----------
  // Order requested: Control and Clarity swapped in the map feel, and keep Command away from Connection.
  // We use: Command (top), Control (right), Connection (bottom), Clarity (left)
  const RADAR_ORDER = ["command", "clarity", "connection", "control"];

  function drawRadar(pct){
    const canvas = $("radar");
    if(!canvas) return;

    const dpr = window.devicePixelRatio || 1;
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    canvas.width = Math.round(w * dpr);
    canvas.height = Math.round(h * dpr);

    const ctx = canvas.getContext("2d");
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const cx = w/2;
    const cy = h/2;
    const r  = Math.min(w,h) * 0.38;

    // background
    ctx.clearRect(0,0,w,h);

    // grid circles
    ctx.strokeStyle = "rgba(255,255,255,.14)";
    ctx.lineWidth = 1;

    const rings = 4;
    for(let i=1;i<=rings;i++){
      const rr = (r * i) / rings;
      ctx.beginPath();
      ctx.arc(cx,cy,rr,0,Math.PI*2);
      ctx.stroke();
    }

    // axes + labels
    const labels = RADAR_ORDER.map(k => ENERGY_LABEL[k]);
    labels.forEach((lab, idx) => {
      const ang = (-Math.PI/2) + (idx * (Math.PI*2/labels.length));
      const x = cx + Math.cos(ang) * r;
      const y = cy + Math.sin(ang) * r;

      // axis line
      ctx.beginPath();
      ctx.moveTo(cx,cy);
      ctx.lineTo(x,y);
      ctx.stroke();

      // label
      ctx.fillStyle = "rgba(255,255,255,.82)";
      ctx.font = "800 12px ui-sans-serif, system-ui";
      ctx.textAlign = (Math.cos(ang) > 0.2) ? "left" : (Math.cos(ang) < -0.2 ? "right" : "center");
      ctx.textBaseline = (Math.sin(ang) > 0.2) ? "top" : (Math.sin(ang) < -0.2 ? "bottom" : "middle");

      const lx = cx + Math.cos(ang) * (r + 16);
      const ly = cy + Math.sin(ang) * (r + 16);
      ctx.fillText(lab, lx, ly);
    });

    // polygon
    const points = RADAR_ORDER.map((k, idx) => {
      const v = clamp(pct[k] || 0, 0, 100) / 100;
      const ang = (-Math.PI/2) + (idx * (Math.PI*2/RADAR_ORDER.length));
      return {
        x: cx + Math.cos(ang) * r * v,
        y: cy + Math.sin(ang) * r * v
      };
    });

    // fill
    ctx.fillStyle = "rgba(255,122,24,.22)";
    ctx.strokeStyle = "rgba(255,122,24,.85)";
    ctx.lineWidth = 2;

    ctx.beginPath();
    points.forEach((p, i) => {
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    });
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // dots
    ctx.fillStyle = "rgba(255,122,24,.95)";
    points.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x,p.y,3.6,0,Math.PI*2);
      ctx.fill();
    });
  }

  // --------- Premium: pick experiment text based on underused energy ----------
function experimentFor(underKey){
  const map = {
    command: {
      intro: "For the next 30 days, practise clean, kind challenge without urgency.",
      steps: [
        "Name the standard clearly, without softening or pushing.",
        "Ask one question that invites ownership, not defence.",
        "Agree one next step and who owns it."
      ],
      reflect: "Reflection prompt: Where did I choose clarity over comfort this week?"
    },

    control: {
      intro: "For the next 30 days, practise lighter structure without losing standards.",
      steps: [
        "End one recurring conversation with a single agreed next step.",
        "Name ownership out loud instead of adding more process.",
        "Resist the urge to tighten control when things feel messy."
      ],
      reflect: "Reflection prompt: Where did I trust people instead of the process?"
    },

    clarity: {
      intro: "For the next 30 days, practise ‘one-message leadership’.",
      steps: [
        "Name one priority in every important conversation.",
        "Explain why it matters in one sentence.",
        "Agree one clear next step before closing."
      ],
      reflect: "Reflection prompt: Where did clarity create momentum this week?"
    },

    connection: {
      intro: "For the next 30 days, practise presence before problem-solving.",
      steps: [
        "Ask one genuine question before offering a view.",
        "Reflect back what you heard, without fixing.",
        "Only move to action once the other person feels heard."
      ],
      reflect: "Reflection prompt: Where did listening change the outcome?"
    }
  };

  return map[underKey] || map.connection;
}

  // --------- Generate full report ----------
  function generateReport(){
    // Validate
    if(!allAnswered()){
      $("warn").style.display = "block";
      // Scroll to first unanswered
      const first = QUESTIONS.find(q => !answers[q.id]);
      if(first){
        const el = document.querySelector(`[data-qid="${first.id}"]`);
        if(el) el.scrollIntoView({ behavior:"smooth", block:"center" });
      }
      return;
    }

    setGenerating(true);

    setTimeout(() => {
      const { pct } = scoreEnergies();
      const balance = computeBalanceScore(pct);
      const ranked = rankEnergies(pct);

      const dominant = ranked.top.k;
      const secondary = ranked.second.k;
      const under = ranked.under.k;
      const ready = isCoachApproachReady(pct);

      // Show Snapshot + Report
      $("snapshotPanel").style.display = "block";
      $("report").style.display = "block";

      // Snapshot bars
      setBar("bar-command","val-command", pct.command);
      setBar("bar-control","val-control", pct.control);
      setBar("bar-clarity","val-clarity", pct.clarity);
      setBar("bar-connection","val-connection", pct.connection);

      // Radar
      drawRadar(pct);

      // Best / Under pressure / Coach guidance (dominant energy)
      const lib = CONTENT[dominant];

      $("bestText").textContent = lib.bestTitle;
      $("bestCallout").innerHTML = `
        <ul style="margin:0; padding-left:18px; color: rgba(255,255,255,.80); line-height:1.55;">
          ${lib.best.map(x => `<li>${escapeHtml(x)}</li>`).join("")}
        </ul>
        <div style="margin-top:10px; color: rgba(255,255,255,.72);">
          <strong style="color: rgba(255,255,255,.88);">Watch outs:</strong>
          ${escapeHtml(lib.watch.join(" "))}
        </div>
      `;

      $("pressureText").textContent = lib.pressure;
      $("resetRoutine").textContent = lib.reset;

      $("coachFocus").textContent = lib.mindset;
      $("coachWatch").textContent = lib.coachMove;
      $("coachBuild").textContent = `${lib.toolset} ${lib.skillset}`;

      // Leadership Approach logic (named vs flexible vs tension)
      const approach = getLeadershipApproach(dominant, secondary, balance);

            // --- Summary strip (new) ---
      $("sumDominant").textContent  = `Dominant: ${ENERGY_LABEL[dominant]} · ${pct[dominant]}%`;
      $("sumSecondary").textContent = `Secondary: ${ENERGY_LABEL[secondary]} · ${pct[secondary]}%`;
      $("sumUnder").textContent     = `Underused: ${ENERGY_LABEL[under]} · ${pct[under]}%`;
      $("sumApproach").textContent  = `Approach: ${approach.label}`;
      $("sumReady").textContent = ready
        ? "🔶 The Coach Approach: Ready"
         : "Range to build";
      $("sumBalance").textContent   = `Balance: ${balance}/100`;

      console.log("READY FLAG =", ready);
      console.log("SUMREADY EL =", document.getElementById("sumReady"));
      console.log("SUMREADY TEXT =", document.getElementById("sumReady")?.textContent);

      // One line that nudges them towards a conversation with you, without being salesy
      $("summaryLine").textContent =
        `This report isn’t a label. It’s a mirror. Your edge is choosing your energy on purpose, not by habit.`;

      // Bring-to-session box (coach-like CTA)
      $("bringToSession").innerHTML = `
        <strong>Bring this to a conversation with Rob:</strong><br>
        1) Where am I leaning too hard on my dominant energy?<br>
        2) What would “one notch more” of my underused energy look like this week?<br>
        3) What’s the one conversation or decision I’m avoiding?
      `;

      $("approachPill").textContent = approach.label;
      $("focusPill").textContent = `Focus: ${approach.focus}`;

      // Main approach line
      $("leadershipApproachLine").textContent = approach.desc;

      // Approach details
      $("approachFocus").textContent = approach.focus;
      $("approachWatchout").textContent = approach.watch;
      $("approachTip").textContent = approach.build;

      // Balance note
      const pairLabel = `${ENERGY_LABEL[dominant]} + ${ENERGY_LABEL[secondary]}`;
      $("approachBalanceNote").textContent =
        `Balance score: ${balance}/100. Top pairing: ${pairLabel}. ${
          approach.type === "named"
            ? "This is a natural adjacent pairing in The Coach Approach."
            : (approach.type === "flex"
                ? "This looks like an even spread, which can support flexibility."
                : "This looks like a non-adjacent pairing, which can create a switching pattern.")
        }`;

      // 30-day experiment
      const exp = experimentFor(under);

$("experimentIntro").textContent = exp.intro;

$("experimentSteps").innerHTML =
  exp.steps.map(s => `<li>${escapeHtml(s)}</li>`).join("");

$("experimentReflection").textContent = exp.reflect;

      // Scroll to report
      $("report").scrollIntoView({ behavior:"smooth", block:"start" });

      // Store latest payload for export
      window.__TCA_LAST = {
        dateStr: new Date().toLocaleString("en-GB"),
        pct,
        balance,
        dominant,
        secondary,
        under,
        dominantLabel: ENERGY_LABEL[dominant],
        secondaryLabel: ENERGY_LABEL[secondary],
        underLabel: ENERGY_LABEL[under],
        approach
      };

      setGenerating(false);
    }, 320);
  }

  // --------- Export modal + download ----------
  function openExport(){
    const payload = window.__TCA_LAST;
    if(!payload){
      // If they haven't generated yet, generate first
      generateReport();
      return;
    }

    const summary = buildSummary(payload);

    // Export object (useful data structure)
    const exportObj = {
      generated_at: payload.dateStr,
      balance_score: payload.balance,
      energies_percent: payload.pct,
      dominant_energy: payload.dominant,
      secondary_energy: payload.secondary,
      underused_energy: payload.under,
      leadership_approach: {
        type: payload.approach.type,
        label: payload.approach.label,
        focus: payload.approach.focus,
        desc: payload.approach.desc,
        watchout: payload.approach.watch,
        coach_tip: payload.approach.build
      },
      summary_text: summary
    };

    const jsonText = JSON.stringify(exportObj, null, 2);

    $("exportArea").value = jsonText;
    $("overlay").style.display = "flex";

    // Also try to download automatically (works well on Mac browsers)
    try{
      const blob = new Blob([jsonText], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "the-coach-approach-leadership-profile.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
    }catch(e){
      // If download is blocked, the modal still provides Copy
    }
  }

  function closeExport(){
    $("overlay").style.display = "none";
  }

  function copyExport(){
    const ta = $("exportArea");
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    try{ document.execCommand("copy"); }catch(e){}
  }

  // --------- Wire buttons ----------

  // Enable/disable Submit buttons based on completion
    function updateCompletionUI(){
    const done = answeredCount();
    const total = QUESTIONS.length;
  const ok = done === total;

  const topBtn = $("submitTop");
  const bottomBtn = $("submitBottom");

  // Hard-set disabled (attribute + property) so the browser respects it
  [topBtn, bottomBtn].forEach(btn => {
    if(!btn) return;
    if(ok){
      btn.disabled = false;
      btn.removeAttribute("disabled");
      btn.setAttribute("aria-disabled", "false");
    } else {
      btn.disabled = true;
      btn.setAttribute("disabled", "");
      btn.setAttribute("aria-disabled", "true");
    }
  });

  // Update progress text if it exists
  const progress = $("progressText");
  if(progress) progress.textContent = `${done} / ${total} answered`;

  // Keep the warning hidden while they’re still answering
  const warn = $("warn");
  if(warn && !ok) warn.style.display = "none";
}(warn && done < total) warn.style.display = "none";
  }
  
  function wire(){
    // Start in single-column mode (snapshot hidden)
    const grid = document.querySelector(".grid");
    if(grid) grid.classList.add("single");
    
    // Render questions
    loadAnswers();
    renderQuestions();
    updateCompletionUI();

    // Submit buttons
$("submitTop").addEventListener("click", (e) => {
  if(!allAnswered()){
    e.preventDefault();
    $("warn").style.display = "block";
    return;
  }
  generateReport();
});

$("submitBottom").addEventListener("click", (e) => {
  if(!allAnswered()){
    e.preventDefault();
    $("warn").style.display = "block";
    return;
  }
  generateReport();
});

    // ⬇️ ADD RESET HERE ⬇️
    $("resetBtn")?.addEventListener("click", () => {
    if (!confirm("Reset all answers and start again?")) return;
    clearAnswers();
    location.reload();
    });
    
    // Print
    $("printBtn").addEventListener("click", () => window.print());

    // Export
    $("exportBtn").addEventListener("click", openExport);

    // Modal close
    $("closeModal").addEventListener("click", closeExport);
    $("closeExport").addEventListener("click", closeExport);
    $("copyExport").addEventListener("click", copyExport);

    // Close modal if clicking outside
    $("overlay").addEventListener("click", (e) => {
      if(e.target && e.target.id === "overlay") closeExport();
    });
  }

  // Init
  wire();
</script>
</body>
</html>
